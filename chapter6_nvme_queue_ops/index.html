<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 6: NVMe Queue Operations (6 Steps)</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: #fff; min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { text-align: center; font-size: 2em; margin-bottom: 30px; color: #00d4ff; }
        .timeline { display: flex; flex-direction: column; gap: 15px; }
        .step { display: grid; grid-template-columns: 80px 1fr 120px; gap: 20px; align-items: center; padding: 20px; border-radius: 10px; transition: all 0.3s; }
        .step:hover { transform: translateX(10px); }
        .step-parallel { background: linear-gradient(90deg, rgba(46,204,113,0.2), rgba(46,204,113,0.05)); border-left: 4px solid #2ecc71; }
        .step-serial { background: linear-gradient(90deg, rgba(231,76,60,0.2), rgba(231,76,60,0.05)); border-left: 4px solid #e74c3c; }
        .step-num { width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5em; font-weight: bold; }
        .step-parallel .step-num { background: linear-gradient(135deg, #2ecc71, #27ae60); }
        .step-serial .step-num { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .step-content h3 { margin-bottom: 8px; font-size: 1.1em; }
        .step-content p { color: #aaa; font-size: 0.9em; }
        .step-status { text-align: center; padding: 10px; border-radius: 8px; font-weight: bold; font-size: 0.85em; }
        .parallel-status { background: rgba(46,204,113,0.3); color: #2ecc71; }
        .serial-status { background: rgba(231,76,60,0.3); color: #e74c3c; }
        .summary { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 40px; }
        .summary-box { background: rgba(255,255,255,0.05); border-radius: 15px; padding: 25px; text-align: center; }
        .summary-box h3 { margin-bottom: 15px; }
        .big-num { font-size: 4em; font-weight: bold; }
        .parallel-box .big-num { color: #2ecc71; }
        .serial-box .big-num { color: #e74c3c; }
        .impact { margin-top: 30px; padding: 20px; background: rgba(231,76,60,0.1); border: 2px solid #e74c3c; border-radius: 10px; text-align: center; }
        .nav { text-align: center; margin-top: 30px; }
        .nav a { color: #00d4ff; text-decoration: none; margin: 0 15px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Chapter 6: NVMe Queue Operations (6 Steps)</h1>
        
        <div class="timeline">
            <div class="step step-serial">
                <div class="step-num">1</div>
                <div class="step-content">
                    <h3>Allocate Command ID</h3>
                    <p>Each thread needs a unique command ID. Uses atomic increment, forcing all threads to serialize.</p>
                </div>
                <div class="step-status serial-status">❌ SERIALIZED<br>Atomic Ops</div>
            </div>

            <div class="step step-parallel">
                <div class="step-num">2</div>
                <div class="step-content">
                    <h3>Write Command to Submission Queue</h3>
                    <p>Each thread writes to a different SQ slot. No contention - all threads can write simultaneously.</p>
                </div>
                <div class="step-status parallel-status">✅ PARALLEL<br>Memory Write</div>
            </div>

            <div class="step step-serial">
                <div class="step-num">3</div>
                <div class="step-content">
                    <h3>Ring SQ Tail Doorbell</h3>
                    <p>Single 4-byte register. Only one thread can write at a time. 31 of 32 threads wait idle.</p>
                </div>
                <div class="step-status serial-status">❌ SERIALIZED<br>Single Register</div>
            </div>

            <div class="step step-parallel">
                <div class="step-num">4</div>
                <div class="step-content">
                    <h3>Poll Completion Queue</h3>
                    <p>Each thread polls its own CQ entry for the phase bit. Parallel memory reads.</p>
                </div>
                <div class="step-status parallel-status">✅ PARALLEL<br>Memory Read</div>
            </div>

            <div class="step step-serial">
                <div class="step-num">5</div>
                <div class="step-content">
                    <h3>Ring CQ Head Doorbell</h3>
                    <p>Same bottleneck as Step 3. Single register forces thread serialization.</p>
                </div>
                <div class="step-status serial-status">❌ SERIALIZED<br>Single Register</div>
            </div>

            <div class="step step-serial">
                <div class="step-num">6</div>
                <div class="step-content">
                    <h3>Wait for CQ Head Acknowledgment</h3>
                    <p>Threads must wait for earlier completions before confirming their own. Creates dependency chain.</p>
                </div>
                <div class="step-status serial-status">❌ SERIALIZED<br>Dependency</div>
            </div>
        </div>

        <div class="summary">
            <div class="summary-box parallel-box">
                <h3>Parallel Steps</h3>
                <div class="big-num">2</div>
                <p>Steps 2 & 4 only</p>
            </div>
            <div class="summary-box serial-box">
                <h3>Serialized Steps</h3>
                <div class="big-num">4</div>
                <p>Steps 1, 3, 5 & 6</p>
            </div>
        </div>

        <div class="impact">
            <h3 style="color: #e74c3c; margin-bottom: 10px;">⚠️ Impact: 4 of 6 steps serialize all GPU threads!</h3>
            <p>During serialization, only 1 of 32 threads in a warp is active = 3.1% SM utilization</p>
        </div>

        <div class="nav">
            <a href="../chapter5_data_paths/index.html">← Chapter 5</a>
            <a href="../index.html">Home</a>
            <a href="../chapter7_sync_tax/index.html">Chapter 7 →</a>
        </div>
    </div>
</body>
</html>
